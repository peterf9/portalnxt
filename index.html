<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextStream - LATAM Partner Master Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-100 font-sans text-slate-800 pb-12">

    <script>
        const i18n = {
            pt: {
                title: "Master QBR Dashboard",
                subtitle: "VisÃ£o 360Âº: EstratÃ©gia, ProspecÃ§Ã£o, Receita e CapacitaÃ§Ã£o",
                exportBtn: "Exportar QBR Completa (CSV)",
                sec1Title: "1. Objetivos Conjuntos (EstratÃ©gia)",
                sec2Title: "2. Clientes Target (ProspecÃ§Ã£o)",
                sec3Title: "3. Pipeline AvanÃ§ado (Colocation + ServiÃ§os)",
                sec4Title: "4. Passaporte NextStream (Treinamentos NPP)",
                // Labels Gerais
                partnerPh: "Nome do Integrador",
                amPh: "Account Manager NextStream",
                addBtn: "Adicionar",
                // Sec 1
                objDescPh: "DescriÃ§Ã£o do Objetivo",
                objOwnerPh: "ResponsÃ¡vel",
                objObsPh: "ObservaÃ§Ãµes",
                // Sec 2
                tgtClientPh: "Cliente Alvo",
                tgtActionPh: "AÃ§Ã£o Mapeada (Ex: Visita ICÂ²)",
                // Sec 3 (Pipeline)
                clientLbl: "Cliente Final",
                termLbl: "Contrato (Meses)",
                racksLbl: "Racks",
                kvaLbl: "kVA/Rack",
                setupLbl: "Setup (R$)",
                movLbl: "Moving (R$)",
                shLbl: "Smart Hands",
                tcvTotal: "TCV Total",
                comTotal: "ComissÃµes Projetadas",
                // Sec 4
                trnPersonPh: "Nome do Colaborador (Canal)"
            },
            es: {
                title: "Master QBR Dashboard",
                subtitle: "VisiÃ³n 360Âº: Estrategia, ProspecciÃ³n, Ingresos y CapacitaciÃ³n",
                exportBtn: "Exportar QBR Completa (CSV)",
                sec1Title: "1. Objetivos Conjuntos (Estrategia)",
                sec2Title: "2. Clientes Target (ProspecciÃ³n)",
                sec3Title: "3. Pipeline Avanzado (Colocation + Servicios)",
                sec4Title: "4. Pasaporte NextStream (Entrenamientos NPP)",
                partnerPh: "Nombre del Integrador",
                amPh: "Account Manager NextStream",
                addBtn: "AÃ±adir",
                objDescPh: "DescripciÃ³n del Objetivo",
                objOwnerPh: "Responsable",
                objObsPh: "Observaciones",
                tgtClientPh: "Cliente Objetivo",
                tgtActionPh: "AcciÃ³n (Ej: Visita ICÂ²)",
                clientLbl: "Cliente Final",
                termLbl: "Contrato (Meses)",
                racksLbl: "Racks",
                kvaLbl: "kVA/Rack",
                setupLbl: "Setup ($)",
                movLbl: "Moving ($)",
                shLbl: "Smart Hands",
                tcvTotal: "TCV Total",
                comTotal: "Comisiones Proyectadas",
                trnPersonPh: "Nombre del Colaborador (Canal)"
            },
            en: {
                title: "Master QBR Dashboard",
                subtitle: "360Âº View: Strategy, Target, Revenue & Enablement",
                exportBtn: "Export Full QBR (CSV)",
                sec1Title: "1. Joint Objectives (Strategy)",
                sec2Title: "2. Target Clients (Go-to-Market)",
                sec3Title: "3. Advanced Pipeline (Colocation + Services)",
                sec4Title: "4. NextStream Passport (NPP Trainings)",
                partnerPh: "Partner Name",
                amPh: "NextStream Account Manager",
                addBtn: "Add",
                objDescPh: "Objective Description",
                objOwnerPh: "Owner",
                objObsPh: "Observations",
                tgtClientPh: "Target Client",
                tgtActionPh: "Action (E.g. ICÂ² Visit)",
                clientLbl: "End Customer",
                termLbl: "Contract (Months)",
                racksLbl: "Racks",
                kvaLbl: "kVA/Rack",
                setupLbl: "Setup ($)",
                movLbl: "Moving ($)",
                shLbl: "Smart Hands",
                tcvTotal: "Total TCV",
                comTotal: "Projected Commissions",
                trnPersonPh: "Employee Name (Partner)"
            }
        };
        let currentLang = 'pt';
    </script>

    <header class="bg-slate-900 text-white p-6 shadow-md border-b-4 border-green-500 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-bold">NextStream | <span class="text-blue-400 font-normal" data-i18n="title">Master QBR Dashboard</span></h1>
                <p class="text-sm text-slate-400 mt-1" data-i18n="subtitle">VisÃ£o 360Âº: EstratÃ©gia, ProspecÃ§Ã£o, Receita e CapacitaÃ§Ã£o</p>
            </div>
            <div class="flex items-center space-x-4">
                <select id="langSelector" onchange="changeLanguage(this.value)" class="bg-slate-800 text-white border border-slate-600 rounded p-2 text-sm focus:outline-none">
                    <option value="pt">ðŸ‡§ðŸ‡· PortuguÃªs</option>
                    <option value="es">ðŸ‡²ðŸ‡½ EspaÃ±ol</option>
                    <option value="en">ðŸ‡ºðŸ‡¸ English</option>
                </select>
                <button onclick="exportAllToCSV()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded text-sm font-bold shadow transition flex items-center">
                    <i class="fas fa-file-export mr-2"></i><span data-i18n="exportBtn">Exportar QBR Completa (CSV)</span>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 mt-4 space-y-6">

        <section class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="partnerInput" class="w-full rounded border-slate-300 p-2 border text-sm font-bold" data-i18n-ph="partnerPh" placeholder="Nome do Integrador">
                <input type="text" id="amInput" class="w-full rounded border-slate-300 p-2 border text-sm" data-i18n-ph="amPh" placeholder="Account Manager NextStream">
                <input type="date" id="qbrDate" class="w-full rounded border-slate-300 p-2 border text-sm">
            </div>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-purple-500">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-bullseye text-purple-500 mr-2"></i><span data-i18n="sec1Title">1. Objetivos Conjuntos (EstratÃ©gia)</span></h2>
            <form id="formObj" class="flex flex-wrap gap-2 mb-4">
                <input type="text" id="objDesc" required class="flex-1 rounded border-slate-300 p-2 border text-sm" data-i18n-ph="objDescPh" placeholder="DescriÃ§Ã£o do Objetivo">
                <input type="date" id="objDate" required class="w-36 rounded border-slate-300 p-2 border text-sm">
                <input type="text" id="objOwner" required class="w-48 rounded border-slate-300 p-2 border text-sm" data-i18n-ph="objOwnerPh" placeholder="ResponsÃ¡vel">
                <input type="text" id="objObs" class="flex-1 rounded border-slate-300 p-2 border text-sm" data-i18n-ph="objObsPh" placeholder="ObservaÃ§Ãµes">
                <button type="submit" class="bg-purple-100 text-purple-700 px-4 py-2 rounded hover:bg-purple-200 transition"><i class="fas fa-plus"></i></button>
            </form>
            <table class="w-full text-sm text-left text-slate-500"><tbody id="tableObj"></tbody></table>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-blue-500">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-crosshairs text-blue-500 mr-2"></i><span data-i18n="sec2Title">2. Clientes Target (ProspecÃ§Ã£o)</span></h2>
            <form id="formTarget" class="flex flex-wrap gap-2 mb-4">
                <input type="text" id="targetName" required class="w-1/4 rounded border-slate-300 p-2 border text-sm" data-i18n-ph="tgtClientPh" placeholder="Cliente Alvo">
                <input type="text" id="targetAction" required class="flex-1 rounded border-slate-300 p-2 border text-sm" data-i18n-ph="tgtActionPh" placeholder="AÃ§Ã£o Mapeada">
                <select id="targetStatus" class="w-36 rounded border-slate-300 p-2 border text-sm">
                    <option value="Mapeamento">Mapeamento</option>
                    <option value="Contato">Contato</option>
                    <option value="Visita IC2">Visita ICÂ²</option>
                </select>
                <input type="text" id="targetObs" class="flex-1 rounded border-slate-300 p-2 border text-sm" data-i18n-ph="objObsPh" placeholder="ObservaÃ§Ãµes">
                <button type="submit" class="bg-blue-100 text-blue-700 px-4 py-2 rounded hover:bg-blue-200 transition"><i class="fas fa-plus"></i></button>
            </form>
            <table class="w-full text-sm text-left text-slate-500"><tbody id="tableTarget"></tbody></table>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-orange-500">
            <h2 class="text-lg font-bold text-slate-800 mb-2"><i class="fas fa-server text-orange-500 mr-2"></i><span data-i18n="sec3Title">3. Pipeline AvanÃ§ado (Colocation + ServiÃ§os)</span></h2>
            
            <form id="formProject" class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-3 mb-4 bg-slate-50 p-4 rounded-lg border border-slate-200">
                <div class="col-span-1 md:col-span-2">
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="clientLbl">Cliente Final</label>
                    <input type="text" id="projClient" required class="w-full rounded border-slate-300 p-2 border text-sm">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="termLbl">Contrato (Meses)</label>
                    <select id="projTerm" required class="w-full rounded border-slate-300 p-2 border text-sm font-bold text-blue-700">
                        <option value="24">24 (5%)</option>
                        <option value="36">36 (7%)</option>
                        <option value="48">48 (8.5%)</option>
                        <option value="60">60 (10%)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="racksLbl">Racks</label>
                    <input type="number" id="projRacks" required min="1" class="w-full rounded border-slate-300 p-2 border text-sm" value="1">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="kvaLbl">kVA/Rack</label>
                    <input type="number" id="projKva" required min="1" step="0.5" class="w-full rounded border-slate-300 p-2 border text-sm">
                </div>

                <div class="col-span-1 md:col-span-4 grid grid-cols-3 gap-3 border-t border-slate-200 pt-3 mt-1">
                    <div>
                        <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="setupLbl">Setup</label>
                        <input type="number" id="projSetup" class="w-full rounded border-slate-300 p-2 border text-sm" placeholder="R$ 25k/rack padrao">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="movLbl">Moving</label>
                        <input type="number" id="projMoving" class="w-full rounded border-slate-300 p-2 border text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="shLbl">Smart Hands (/mÃªs)</label>
                        <input type="number" id="projSmartHands" class="w-full rounded border-slate-300 p-2 border text-sm">
                    </div>
                </div>
                
                <div class="col-span-1 border-t border-slate-200 pt-3 mt-1 flex items-end">
                    <button type="submit" class="w-full bg-slate-900 text-white font-bold px-4 py-2 rounded hover:bg-slate-800 transition shadow-sm"><i class="fas fa-plus"></i></button>
                </div>
            </form>
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-slate-500">
                    <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                        <tr><th class="p-3">Info</th><th class="p-3 text-right">TCV</th><th class="p-3 text-right">ComissÃ£o</th><th class="p-3 text-center">X</th></tr>
                    </thead>
                    <tbody id="tableProject"></tbody>
                </table>
            </div>
            <div class="mt-4 p-4 bg-slate-50 border border-slate-200 rounded-lg flex justify-end space-x-8">
                <div class="text-right">
                    <p class="text-xs font-bold text-slate-500 uppercase" data-i18n="tcvTotal">TCV Total</p>
                    <p id="totalTcvView" class="text-2xl font-black text-slate-800">0.00</p>
                </div>
                <div class="text-right">
                    <p class="text-xs font-bold text-slate-500 uppercase" data-i18n="comTotal">ComissÃµes Projetadas</p>
                    <p id="totalComView" class="text-2xl font-black text-green-600">0.00</p>
                </div>
            </div>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-green-500">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-graduation-cap text-green-500 mr-2"></i><span data-i18n="sec4Title">4. Passaporte NextStream (Treinamentos NPP)</span></h2>
            <form id="formTrain" class="flex flex-wrap gap-2 mb-4">
                <select id="trainName" class="w-1/4 rounded border-slate-300 p-2 border text-sm">
                    <option value="Comercial BÃ¡sico">Comercial BÃ¡sico</option>
                    <option value="Colocation Alta Densidade">Colocation Alta Densidade</option>
                    <option value="Visita IC2 / Serena">Visita Operacional ICÂ²</option>
                </select>
                <input type="text" id="trainPerson" required class="flex-1 rounded border-slate-300 p-2 border text-sm" data-i18n-ph="trnPersonPh" placeholder="Nome do Colaborador">
                <input type="date" id="trainDate" required class="w-36 rounded border-slate-300 p-2 border text-sm">
                <select id="trainStatus" class="w-36 rounded border-slate-300 p-2 border text-sm">
                    <option value="Agendado">Agendado</option>
                    <option value="Concluido">ConcluÃ­do</option>
                </select>
                <button type="submit" class="bg-green-100 text-green-700 px-4 py-2 rounded hover:bg-green-200 transition"><i class="fas fa-plus"></i></button>
            </form>
            <table class="w-full text-sm text-left text-slate-500"><tbody id="tableTrain"></tbody></table>
        </section>
    </main>

    <script>
        // --- Motor i18n ---
        function changeLanguage(lang) {
            currentLang = lang;
            const dict = i18n[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => { el.innerText = dict[el.getAttribute('data-i18n')]; });
            document.querySelectorAll('[data-i18n-ph]').forEach(el => { el.placeholder = dict[el.getAttribute('data-i18n-ph')]; });
            renderProject(); 
        }
        document.addEventListener('DOMContentLoaded', () => { changeLanguage('pt'); document.getElementById('qbrDate').valueAsDate = new Date(); });

        // --- Dados (MemÃ³ria da SessÃ£o) ---
        const qbrData = { objetivos: [], targets: [], projetos: [], treinamentos: [] };
        const VALOR_KVA = 1100;

        // FunÃ§Ãµes GenÃ©ricas
        function addRow(e, formId, dataArray, dataObj, renderFunc) {
            e.preventDefault(); dataArray.push(dataObj); document.getElementById(formId).reset(); renderFunc();
        }
        function removeRow(index, dataArray, renderFunc) {
            dataArray.splice(index, 1); renderFunc();
        }

        // Bloco 1: Objetivos
        document.getElementById('formObj').addEventListener('submit', (e) => {
            addRow(e, 'formObj', qbrData.objetivos, {
                desc: document.getElementById('objDesc').value, date: document.getElementById('objDate').value,
                owner: document.getElementById('objOwner').value, obs: document.getElementById('objObs').value
            }, renderObj);
        });
        function renderObj() {
            const tbody = document.getElementById('tableObj'); tbody.innerHTML = '';
            qbrData.objetivos.forEach((item, index) => {
                tbody.innerHTML += `<tr class="border-b"><td class="py-2 font-medium">${item.desc}</td><td class="py-2">${item.date}</td><td class="py-2"><span class="bg-slate-200 px-2 py-1 rounded text-xs">${item.owner}</span></td><td class="py-2">${item.obs}</td><td class="py-2"><button onclick="removeRow(${index}, qbrData.objetivos, renderObj)" class="text-red-500"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        // Bloco 2: Target
        document.getElementById('formTarget').addEventListener('submit', (e) => {
            addRow(e, 'formTarget', qbrData.targets, {
                client: document.getElementById('targetName').value, action: document.getElementById('targetAction').value,
                status: document.getElementById('targetStatus').value, obs: document.getElementById('targetObs').value
            }, renderTarget);
        });
        function renderTarget() {
            const tbody = document.getElementById('tableTarget'); tbody.innerHTML = '';
            qbrData.targets.forEach((item, index) => {
                tbody.innerHTML += `<tr class="border-b"><td class="py-2 font-bold">${item.client}</td><td class="py-2">${item.action}</td><td class="py-2"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${item.status}</span></td><td class="py-2">${item.obs}</td><td class="py-2"><button onclick="removeRow(${index}, qbrData.targets, renderTarget)" class="text-red-500"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        // Bloco 3: Pipeline Colocation
        document.getElementById('formProject').addEventListener('submit', (e) => {
            e.preventDefault();
            const racks = parseInt(document.getElementById('projRacks').value) || 0;
            const kva = parseFloat(document.getElementById('projKva').value) || 0;
            const term = parseInt(document.getElementById('projTerm').value);
            const setupInput = document.getElementById('projSetup').value;
            const setup = setupInput !== "" ? parseFloat(setupInput) : (racks * 25000); 
            const moving = parseFloat(document.getElementById('projMoving').value) || 0;
            const smartHands = parseFloat(document.getElementById('projSmartHands').value) || 0;

            const totalKva = racks * kva;
            const mrr = (totalKva * VALOR_KVA) + smartHands;
            const tcv = (mrr * term) + setup + moving;

            let comPerc = 0.05;
            if (term === 36) comPerc = 0.07;
            if (term === 48) comPerc = 0.085;
            if (term >= 60) comPerc = 0.10;

            qbrData.projetos.push({ client: document.getElementById('projClient').value, term, racks, kva, totalKva, setup, moving, smartHands, tcv, comPerc: comPerc*100, comValor: tcv*comPerc });
            document.getElementById('formProject').reset();
            document.getElementById('projTerm').value = "24"; document.getElementById('projRacks').value = "1";
            renderProject();
        });
        function renderProject() {
            const tbody = document.getElementById('tableProject'); tbody.innerHTML = '';
            let sumTcv = 0; let sumCom = 0;
            const curr = currentLang === 'en' ? '$' : 'R$';

            qbrData.projetos.forEach((item, index) => {
                sumTcv += item.tcv; sumCom += item.comValor;
                tbody.innerHTML += `<tr class="border-b hover:bg-white transition">
                    <td class="p-3"><span class="font-bold">${item.client}</span><br><span class="text-xs text-slate-500">${item.term}m | ${item.racks} Racks | ${item.totalKva} kVA | Set:${item.setup} | Mov:${item.moving} | SH:${item.smartHands}/m</span></td>
                    <td class="p-3 text-right font-black text-slate-800">${item.tcv.toLocaleString('en-US', {minimumFractionDigits:2})}</td>
                    <td class="p-3 text-right"><span class="font-black text-green-600">${item.comValor.toLocaleString('en-US', {minimumFractionDigits:2})}</span> <span class="text-xs text-slate-400">(${item.comPerc}%)</span></td>
                    <td class="p-3 text-center"><button onclick="removeRow(${index}, qbrData.projetos, renderProject)" class="text-red-400"><i class="fas fa-trash"></i></button></td></tr>`;
            });
            document.getElementById('totalTcvView').innerText = `${curr} ${sumTcv.toLocaleString('en-US', {minimumFractionDigits:2})}`;
            document.getElementById('totalComView').innerText = `${curr} ${sumCom.toLocaleString('en-US', {minimumFractionDigits:2})}`;
        }

        // Bloco 4: Treinamentos
        document.getElementById('formTrain').addEventListener('submit', (e) => {
            addRow(e, 'formTrain', qbrData.treinamentos, {
                course: document.getElementById('trainName').value, person: document.getElementById('trainPerson').value,
                date: document.getElementById('trainDate').value, status: document.getElementById('trainStatus').value
            }, renderTrain);
        });
        function renderTrain() {
            const tbody = document.getElementById('tableTrain'); tbody.innerHTML = '';
            qbrData.treinamentos.forEach((item, index) => {
                tbody.innerHTML += `<tr class="border-b"><td class="py-2 font-medium">${item.course}</td><td class="py-2">${item.person}</td><td class="py-2">${item.date}</td><td class="py-2"><span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">${item.status}</span></td><td class="py-2"><button onclick="removeRow(${index}, qbrData.treinamentos, renderTrain)" class="text-red-500"><i class="fas fa-trash"></i></button></td></tr>`;
            });
        }

        // ExportaÃ§Ã£o Master
        function exportAllToCSV() {
            const partner = document.getElementById('partnerInput').value || 'Parceiro';
            const date = document.getElementById('qbrDate').value || new Date().toISOString().split('T')[0];
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += `NEXTSTREAM MASTER QBR\nParceiro:,${partner}\nData:,${date}\n\n`;

            csvContent += "1. OBJETIVOS ESTRATEGICOS\nObjetivo,Prazo,Responsavel,Observacoes\n";
            qbrData.objetivos.forEach(o => { csvContent += `"${o.desc}","${o.date}","${o.owner}","${o.obs}"\n`; });
            csvContent += "\n";

            csvContent += "2. CLIENTES TARGET\nCliente,Acao Mapeada,Status,Observacoes\n";
            qbrData.targets.forEach(t => { csvContent += `"${t.client}","${t.action}","${t.status}","${t.obs}"\n`; });
            csvContent += "\n";

            csvContent += "3. PIPELINE DE COLOCATION E SERVICOS\nCliente,Contrato(M),Racks,kVA Total,Setup,Moving,SmartHands,TCV,Comissao(%)\n";
            qbrData.projetos.forEach(p => { csvContent += `"${p.client}",${p.term},${p.racks},${p.totalKva},${p.setup},${p.moving},${p.smartHands},${p.tcv},${p.comPerc}\n`; });
            csvContent += "\n";

            csvContent += "4. TREINAMENTOS (NPP)\nCurso,Colaborador,Data,Status\n";
            qbrData.treinamentos.forEach(t => { csvContent += `"${t.course}","${t.person}","${t.date}","${t.status}"\n`; });

            const link = document.createElement("a");
            link.setAttribute("href", encodeURI(csvContent));
            link.setAttribute("download", `QBR_Completa_${partner.replace(/\s+/g, '_')}_${date}.csv`);
            document.body.appendChild(link);
            link.click(); document.body.removeChild(link);
        }
    </script>
</body>
</html>
