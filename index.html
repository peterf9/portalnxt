<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextStream - QBR & Joint Strategy Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-100 font-sans text-slate-800 pb-12">

    <header class="bg-slate-900 text-white p-6 shadow-md border-b-4 border-green-500 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">NextStream | <span class="text-blue-400 font-normal">Channel Strategy & QBR</span></h1>
                <p class="text-sm text-slate-400 mt-1">Joint Business Plan - Monitoramento Contínuo</p>
            </div>
            <div class="flex space-x-4">
                <div class="text-right hidden md:block">
                    <p class="text-sm font-semibold text-slate-300">Parceiro: <span id="headerPartnerName" class="text-white">A Definir</span></p>
                    <p class="text-xs text-teal-400"><i class="fas fa-leaf mr-1"></i> Compliance ESG Ativo</p>
                </div>
                <button onclick="exportAllToCSV()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded text-sm font-bold shadow transition">
                    <i class="fas fa-file-export mr-2"></i>Exportar QBR (CSV)
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 mt-4 space-y-6">

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-slate-800"><i class="fas fa-handshake text-blue-500 mr-2"></i>Contexto da Parceria</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="partnerInput" placeholder="Nome do Integrador (Ex: Kyndryl)" class="w-full rounded-md border-slate-300 p-2 border text-sm" oninput="document.getElementById('headerPartnerName').innerText = this.value || 'A Definir'">
                <input type="text" id="amInput" placeholder="Account Manager NextStream" class="w-full rounded-md border-slate-300 p-2 border text-sm">
                <input type="date" id="qbrDate" class="w-full rounded-md border-slate-300 p-2 border text-sm" title="Data da Revisão">
            </div>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-purple-500">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-bullseye text-purple-500 mr-2"></i>1. Objetivos Conjuntos (Estratégia)</h2>
            
            <form id="formObj" class="flex gap-2 mb-4">
                <input type="text" id="objDesc" placeholder="Descrição do Objetivo" required class="flex-1 rounded-md border-slate-300 p-2 border text-sm">
                <input type="date" id="objDate" required class="w-36 rounded-md border-slate-300 p-2 border text-sm">
                <input type="text" id="objOwner" placeholder="Responsável" required class="w-48 rounded-md border-slate-300 p-2 border text-sm">
                <input type="text" id="objObs" placeholder="Observações" class="flex-1 rounded-md border-slate-300 p-2 border text-sm">
                <button type="submit" class="bg-purple-100 text-purple-700 px-4 py-2 rounded hover:bg-purple-200 transition"><i class="fas fa-plus"></i></button>
            </form>

            <table class="w-full text-sm text-left text-slate-500">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                    <tr><th>Objetivo</th><th>Prazo</th><th>Responsável</th><th>Observações</th><th>Ação</th></tr>
                </thead>
                <tbody id="tableObj"></tbody>
            </table>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-blue-500">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-crosshairs text-blue-500 mr-2"></i>2. Clientes Target (Go-to-Market)</h2>
            
            <form id="formTarget" class="flex gap-2 mb-4">
                <input type="text" id="targetName" placeholder="Cliente Alvo" required class="w-1/4 rounded-md border-slate-300 p-2 border text-sm">
                <input type="text" id="targetAction" placeholder="Ação Mapeada (Ex: Evento no IC²)" required class="flex-1 rounded-md border-slate-300 p-2 border text-sm">
                <select id="targetStatus" class="w-36 rounded-md border-slate-300 p-2 border text-sm">
                    <option>Mapeamento</option><option>Contato Inicial</option><option>Reunião Agendada</option><option>Visita IC²</option>
                </select>
                <input type="text" id="targetObs" placeholder="Observações" class="flex-1 rounded-md border-slate-300 p-2 border text-sm">
                <button type="submit" class="bg-blue-100 text-blue-700 px-4 py-2 rounded hover:bg-blue-200 transition"><i class="fas fa-plus"></i></button>
            </form>

            <table class="w-full text-sm text-left text-slate-500">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                    <tr><th>Cliente</th><th>Ação Mapeada</th><th>Status</th><th>Observações</th><th>Ação</th></tr>
                </thead>
                <tbody id="tableTarget"></tbody>
            </table>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-orange-500">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-server text-orange-500 mr-2"></i>3. Projetos em Desenvolvimento (Pipeline Colocation)</h2>
            
            <form id="formProject" class="flex flex-wrap gap-2 mb-4">
                <input type="text" id="projClient" placeholder="Cliente Final" required class="w-48 rounded-md border-slate-300 p-2 border text-sm">
                <input type="number" id="projRacks" placeholder="Racks" required class="w-24 rounded-md border-slate-300 p-2 border text-sm">
                <input type="number" id="projKva" placeholder="kVA/Rack" required class="w-24 rounded-md border-slate-300 p-2 border text-sm">
                <select id="projStatus" class="w-36 rounded-md border-slate-300 p-2 border text-sm">
                    <option>Qualificação</option><option>Proposta</option><option>Negociação</option><option>Fechado/Won</option>
                </select>
                <input type="text" id="projObs" placeholder="Próximo Passo / Obstáculo" class="flex-1 rounded-md border-slate-300 p-2 border text-sm">
                <button type="submit" class="bg-orange-100 text-orange-700 px-4 py-2 rounded hover:bg-orange-200 transition"><i class="fas fa-plus"></i></button>
            </form>

            <table class="w-full text-sm text-left text-slate-500">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                    <tr><th>Cliente</th><th>Racks</th><th>kVA / Rack</th><th>Potência Total</th><th>Status</th><th>Próximo Passo</th><th>Ação</th></tr>
                </thead>
                <tbody id="tableProject"></tbody>
            </table>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-green-500">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-graduation-cap text-green-500 mr-2"></i>4. Passaporte NextStream (Treinamentos NPP)</h2>
            
            <form id="formTrain" class="flex gap-2 mb-4">
                <select id="trainName" class="w-1/4 rounded-md border-slate-300 p-2 border text-sm">
                    <option>Certificação Comercial Básica</option>
                    <option>Certificação Colocation Alta Densidade</option>
                    <option>Workshop IC² & IA Preditiva</option>
                    <option>Argumentação ESG (Serena Energia)</option>
                </select>
                <input type="text" id="trainPerson" placeholder="Nome do Colaborador (Canal)" required class="flex-1 rounded-md border-slate-300 p-2 border text-sm">
                <input type="date" id="trainDate" required class="w-36 rounded-md border-slate-300 p-2 border text-sm">
                <select id="trainStatus" class="w-36 rounded-md border-slate-300 p-2 border text-sm">
                    <option>Agendado</option><option>Concluído</option><option>Pendente</option>
                </select>
                <button type="submit" class="bg-green-100 text-green-700 px-4 py-2 rounded hover:bg-green-200 transition"><i class="fas fa-plus"></i></button>
            </form>

            <table class="w-full text-sm text-left text-slate-500">
                <thead class="text-xs text-slate-700 uppercase bg-slate-50">
                    <tr><th>Treinamento</th><th>Colaborador</th><th>Data Prevista/Realizada</th><th>Status</th><th>Ação</th></tr>
                </thead>
                <tbody id="tableTrain"></tbody>
            </table>
        </section>

    </main>

    <script>
        // Memória de Dados Temporária
        const qbrData = { objetivos: [], targets: [], projetos: [], treinamentos: [] };

        // Funções Genéricas de Inserção e Renderização
        function addRow(e, formId, dataArray, dataObj, renderFunc) {
            e.preventDefault();
            dataArray.push(dataObj);
            document.getElementById(formId).reset();
            renderFunc();
        }

        function removeRow(index, dataArray, renderFunc) {
            dataArray.splice(index, 1);
            renderFunc();
        }

        // 1. Objetivos
        document.getElementById('formObj').addEventListener('submit', (e) => {
            const obj = {
                desc: document.getElementById('objDesc').value,
                date: document.getElementById('objDate').value,
                owner: document.getElementById('objOwner').value,
                obs: document.getElementById('objObs').value
            };
            addRow(e, 'formObj', qbrData.objetivos, obj, renderObj);
        });

        function renderObj() {
            const tbody = document.getElementById('tableObj');
            tbody.innerHTML = '';
            qbrData.objetivos.forEach((item, index) => {
                tbody.innerHTML += `<tr class="border-b">
                    <td class="py-2 font-medium">${item.desc}</td><td class="py-2">${item.date}</td>
                    <td class="py-2"><span class="bg-slate-200 text-slate-700 px-2 py-1 rounded text-xs">${item.owner}</span></td>
                    <td class="py-2">${item.obs}</td>
                    <td class="py-2"><button onclick="removeRow(${index}, qbrData.objetivos, renderObj)" class="text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></button></td>
                </tr>`;
            });
        }

        // 2. Target
        document.getElementById('formTarget').addEventListener('submit', (e) => {
            const obj = {
                client: document.getElementById('targetName').value,
                action: document.getElementById('targetAction').value,
                status: document.getElementById('targetStatus').value,
                obs: document.getElementById('targetObs').value
            };
            addRow(e, 'formTarget', qbrData.targets, obj, renderTarget);
        });

        function renderTarget() {
            const tbody = document.getElementById('tableTarget');
            tbody.innerHTML = '';
            qbrData.targets.forEach((item, index) => {
                tbody.innerHTML += `<tr class="border-b">
                    <td class="py-2 font-bold">${item.client}</td><td class="py-2">${item.action}</td>
                    <td class="py-2"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">${item.status}</span></td>
                    <td class="py-2">${item.obs}</td>
                    <td class="py-2"><button onclick="removeRow(${index}, qbrData.targets, renderTarget)" class="text-red-500"><i class="fas fa-trash"></i></button></td>
                </tr>`;
            });
        }

        // 3. Projetos
        document.getElementById('formProject').addEventListener('submit', (e) => {
            const racks = parseInt(document.getElementById('projRacks').value);
            const kva = parseFloat(document.getElementById('projKva').value);
            const obj = {
                client: document.getElementById('projClient').value,
                racks: racks, kva: kva, total: racks * kva,
                status: document.getElementById('projStatus').value,
                obs: document.getElementById('projObs').value
            };
            addRow(e, 'formProject', qbrData.projetos, obj, renderProject);
        });

        function renderProject() {
            const tbody = document.getElementById('tableProject');
            tbody.innerHTML = '';
            qbrData.projetos.forEach((item, index) => {
                tbody.innerHTML += `<tr class="border-b">
                    <td class="py-2 font-bold">${item.client}</td><td class="py-2 text-center">${item.racks}</td>
                    <td class="py-2 text-center text-orange-600 font-bold">${item.kva}</td>
                    <td class="py-2 text-center font-bold">${item.total} kVA</td>
                    <td class="py-2"><span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">${item.status}</span></td>
                    <td class="py-2">${item.obs}</td>
                    <td class="py-2"><button onclick="removeRow(${index}, qbrData.projetos, renderProject)" class="text-red-500"><i class="fas fa-trash"></i></button></td>
                </tr>`;
            });
        }

        // 4. Treinamentos
        document.getElementById('formTrain').addEventListener('submit', (e) => {
            const obj = {
                course: document.getElementById('trainName').value,
                person: document.getElementById('trainPerson').value,
                date: document.getElementById('trainDate').value,
                status: document.getElementById('trainStatus').value
            };
            addRow(e, 'formTrain', qbrData.treinamentos, obj, renderTrain);
        });

        function renderTrain() {
            const tbody = document.getElementById('tableTrain');
            tbody.innerHTML = '';
            qbrData.treinamentos.forEach((item, index) => {
                let statusColor = item.status === 'Concluído' ? 'bg-green-100 text-green-800' : (item.status === 'Pendente' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800');
                tbody.innerHTML += `<tr class="border-b">
                    <td class="py-2 font-medium">${item.course}</td><td class="py-2">${item.person}</td><td class="py-2">${item.date}</td>
                    <td class="py-2"><span class="${statusColor} px-2 py-1 rounded text-xs">${item.status}</span></td>
                    <td class="py-2"><button onclick="removeRow(${index}, qbrData.treinamentos, renderTrain)" class="text-red-500"><i class="fas fa-trash"></i></button></td>
                </tr>`;
            });
        }

        // Função Master de Exportação Segura (CSV Consolidado)
        function exportAllToCSV() {
            const partner = document.getElementById('partnerInput').value || 'Parceiro';
            const date = document.getElementById('qbrDate').value || new Date().toISOString().split('T')[0];
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += `NEXTSTREAM JOINT BUSINESS PLAN & QBR\nParceiro:,${partner}\nData:,${date}\n\n`;

            // Sec 1
            csvContent += "1. OBJETIVOS ESTRATEGICOS\nObjetivo,Prazo,Responsavel,Observacoes\n";
            qbrData.objetivos.forEach(o => { csvContent += `"${o.desc}","${o.date}","${o.owner}","${o.obs}"\n`; });
            csvContent += "\n";

            // Sec 2
            csvContent += "2. CLIENTES TARGET\nCliente,Acao Mapeada,Status,Observacoes\n";
            qbrData.targets.forEach(t => { csvContent += `"${t.client}","${t.action}","${t.status}","${t.obs}"\n`; });
            csvContent += "\n";

            // Sec 3
            csvContent += "3. PROJETOS EM DESENVOLVIMENTO\nCliente,Racks,kVA por Rack,Potencia Total (kVA),Status,Proximo Passo\n";
            qbrData.projetos.forEach(p => { csvContent += `"${p.client}",${p.racks},${p.kva},${p.total},"${p.status}","${p.obs}"\n`; });
            csvContent += "\n";

            // Sec 4
            csvContent += "4. TREINAMENTOS (NPP)\nCurso,Colaborador,Data,Status\n";
            qbrData.treinamentos.forEach(t => { csvContent += `"${t.course}","${t.person}","${t.date}","${t.status}"\n`; });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `QBR_${partner.replace(/\s+/g, '_')}_${date}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
