<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextStream - LATAM QBR Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-slate-100 font-sans text-slate-800 pb-12">

    <script>
        const i18n = {
            pt: {
                title: "Estrat√©gia de Canal & QBR",
                subtitle: "Integra√ß√£o de Receita: Colocation & Servi√ßos Acoplados",
                exportBtn: "Exportar QBR (CSV)",
                sec1Title: "Contexto da Parceria",
                partnerPh: "Nome do Integrador",
                amPh: "Account Manager NextStream",
                sec2Title: "Pipeline Avan√ßado (Colocation + Servi√ßos)",
                clientLbl: "Cliente Final",
                termLbl: "Tempo de Contrato",
                racksLbl: "Racks",
                kvaLbl: "kVA/Rack",
                setupLbl: "Setup (Total)",
                movLbl: "Moving (Total)",
                shLbl: "Smart Hands (/m√™s)",
                addBtn: "Adicionar",
                thClient: "Cliente",
                thContract: "Contrato",
                thSpace: "Space/Power",
                thServices: "Servi√ßos Adic.",
                thTCV: "TCV",
                thCom: "Comiss√£o Proj.",
                thAction: "A√ß√£o",
                tcvTotal: "TCV Total Pipeline",
                comTotal: "Comiss√µes Potenciais"
            },
            es: {
                title: "Estrategia de Canal y QBR",
                subtitle: "Integraci√≥n de Ingresos: Colocation y Servicios",
                exportBtn: "Exportar QBR (CSV)",
                sec1Title: "Contexto de la Alianza",
                partnerPh: "Nombre del Integrador",
                amPh: "Account Manager NextStream",
                sec2Title: "Pipeline Avanzado (Colocation + Servicios)",
                clientLbl: "Cliente Final",
                termLbl: "Tiempo de Contrato",
                racksLbl: "Racks",
                kvaLbl: "kVA/Rack",
                setupLbl: "Setup (Total)",
                movLbl: "Moving (Total)",
                shLbl: "Smart Hands (/mes)",
                addBtn: "A√±adir",
                thClient: "Cliente",
                thContract: "Contrato",
                thSpace: "Space/Power",
                thServices: "Servicios Adic.",
                thTCV: "TCV",
                thCom: "Comisi√≥n Proy.",
                thAction: "Acci√≥n",
                tcvTotal: "TCV Total Pipeline",
                comTotal: "Comisiones Potenciales"
            },
            en: {
                title: "Channel Strategy & QBR",
                subtitle: "Revenue Integration: Colocation & Managed Services",
                exportBtn: "Export QBR (CSV)",
                sec1Title: "Partnership Context",
                partnerPh: "Partner Name",
                amPh: "NextStream Account Manager",
                sec2Title: "Advanced Pipeline (Colocation + Services)",
                clientLbl: "End Customer",
                termLbl: "Contract Term",
                racksLbl: "Racks",
                kvaLbl: "kVA/Rack",
                setupLbl: "Setup (Total)",
                movLbl: "Moving (Total)",
                shLbl: "Smart Hands (/month)",
                addBtn: "Add",
                thClient: "Customer",
                thContract: "Contract",
                thSpace: "Space/Power",
                thServices: "Add. Services",
                thTCV: "TCV",
                thCom: "Proj. Commission",
                thAction: "Action",
                tcvTotal: "Total Pipeline TCV",
                comTotal: "Potential Commissions"
            }
        };
        let currentLang = 'pt'; // Idioma padr√£o
    </script>

    <header class="bg-slate-900 text-white p-6 shadow-md border-b-4 border-green-500 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-bold">NextStream | <span class="text-blue-400 font-normal" data-i18n="title">Estrat√©gia de Canal & QBR</span></h1>
                <p class="text-sm text-slate-400 mt-1" data-i18n="subtitle">Integra√ß√£o de Receita: Colocation & Servi√ßos Acoplados</p>
            </div>
            <div class="flex items-center space-x-4">
                <select id="langSelector" onchange="changeLanguage(this.value)" class="bg-slate-800 text-white border border-slate-600 rounded p-2 text-sm focus:outline-none">
                    <option value="pt">üáßüá∑ Portugu√™s</option>
                    <option value="es">üá≤üáΩ Espa√±ol</option>
                    <option value="en">üá∫üá∏ English</option>
                </select>
                <button onclick="exportAllToCSV()" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded text-sm font-bold shadow transition flex items-center">
                    <i class="fas fa-file-export mr-2"></i><span data-i18n="exportBtn">Exportar QBR (CSV)</span>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 mt-4 space-y-6">

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold text-slate-800 mb-4"><i class="fas fa-handshake text-blue-500 mr-2"></i><span data-i18n="sec1Title">Contexto da Parceria</span></h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="partnerInput" class="w-full rounded-md border-slate-300 p-2 border text-sm" data-i18n-ph="partnerPh" placeholder="Nome do Integrador">
                <input type="text" id="amInput" class="w-full rounded-md border-slate-300 p-2 border text-sm" data-i18n-ph="amPh" placeholder="Account Manager NextStream">
                <input type="date" id="qbrDate" class="w-full rounded-md border-slate-300 p-2 border text-sm">
            </div>
        </section>

        <section class="bg-white p-6 rounded-lg shadow-sm border border-slate-200 border-l-4 border-l-orange-500">
            <h2 class="text-lg font-bold text-slate-800 mb-2"><i class="fas fa-server text-orange-500 mr-2"></i><span data-i18n="sec2Title">Pipeline Avan√ßado (Colocation + Servi√ßos)</span></h2>
            
            <form id="formProject" class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-3 mb-4 bg-slate-50 p-4 rounded-lg border border-slate-200">
                <div class="col-span-1 md:col-span-2">
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="clientLbl">Cliente Final</label>
                    <input type="text" id="projClient" required class="w-full rounded border-slate-300 p-2 border text-sm">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="termLbl">Tempo de Contrato</label>
                    <select id="projTerm" required class="w-full rounded border-slate-300 p-2 border text-sm font-bold text-blue-700">
                        <option value="24">24 (5%)</option>
                        <option value="36">36 (7%)</option>
                        <option value="48">48 (8.5%)</option>
                        <option value="60">60 (10%)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="racksLbl">Racks</label>
                    <input type="number" id="projRacks" required min="1" class="w-full rounded border-slate-300 p-2 border text-sm" value="1">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="kvaLbl">kVA/Rack</label>
                    <input type="number" id="projKva" required min="1" step="0.5" class="w-full rounded border-slate-300 p-2 border text-sm">
                </div>

                <div class="col-span-1 md:col-span-4 grid grid-cols-3 gap-3 border-t border-slate-200 pt-3 mt-1">
                    <div>
                        <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="setupLbl">Setup (Total)</label>
                        <input type="number" id="projSetup" class="w-full rounded border-slate-300 p-2 border text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="movLbl">Moving (Total)</label>
                        <input type="number" id="projMoving" class="w-full rounded border-slate-300 p-2 border text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-slate-600 mb-1" data-i18n="shLbl">Smart Hands (/m√™s)</label>
                        <input type="number" id="projSmartHands" class="w-full rounded border-slate-300 p-2 border text-sm">
                    </div>
                </div>
                
                <div class="col-span-1 border-t border-slate-200 pt-3 mt-1 flex items-end">
                    <button type="submit" class="w-full bg-slate-900 text-white font-bold px-4 py-2 rounded hover:bg-slate-800 transition shadow-sm">
                        <i class="fas fa-plus mr-1"></i> <span data-i18n="addBtn">Adicionar</span>
                    </button>
                </div>
            </form>

            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-slate-500">
                    <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                        <tr>
                            <th class="p-3" data-i18n="thClient">Cliente</th>
                            <th class="p-3 text-center" data-i18n="thContract">Contrato</th>
                            <th class="p-3 text-center" data-i18n="thSpace">Space/Power</th>
                            <th class="p-3 text-right" data-i18n="thServices">Servi√ßos Adic.</th>
                            <th class="p-3 text-right text-blue-700" data-i18n="thTCV">TCV</th>
                            <th class="p-3 text-right text-green-700" data-i18n="thCom">Comiss√£o Proj.</th>
                            <th class="p-3 text-center" data-i18n="thAction">A√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="tableProject"></tbody>
                </table>
            </div>
            
            <div class="mt-4 p-4 bg-slate-50 border border-slate-200 rounded-lg flex justify-end space-x-8">
                <div class="text-right">
                    <p class="text-xs font-bold text-slate-500 uppercase" data-i18n="tcvTotal">TCV Total Pipeline</p>
                    <p id="totalTcvView" class="text-2xl font-black text-slate-800">0.00</p>
                </div>
                <div class="text-right">
                    <p class="text-xs font-bold text-slate-500 uppercase" data-i18n="comTotal">Comiss√µes Potenciais</p>
                    <p id="totalComView" class="text-2xl font-black text-green-600">0.00</p>
                </div>
            </div>
        </section>

    </main>

    <script>
        // --- Motor de Internacionaliza√ß√£o (i18n) ---
        function changeLanguage(lang) {
            currentLang = lang;
            const dict = i18n[lang];
            
            // Traduz textos vis√≠veis
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (dict[key]) el.innerText = dict[key];
            });

            // Traduz placeholders
            document.querySelectorAll('[data-i18n-ph]').forEach(el => {
                const key = el.getAttribute('data-i18n-ph');
                if (dict[key]) el.placeholder = dict[key];
            });
            
            renderProject(); // Re-renderiza a tabela para aplicar formata√ß√µes de moeda se necess√°rio (simplicado para n√∫meros aqui)
        }

        // Inicializa o idioma na carga da p√°gina
        document.addEventListener('DOMContentLoaded', () => { changeLanguage('pt'); });

        // --- L√≥gica de Neg√≥cios (NextStream Pipeline) ---
        const projetos = [];
        const VALOR_KVA = 1100;

        document.getElementById('formProject').addEventListener('submit', (e) => {
            e.preventDefault();

            const racks = parseInt(document.getElementById('projRacks').value) || 0;
            const kva = parseFloat(document.getElementById('projKva').value) || 0;
            const term = parseInt(document.getElementById('projTerm').value);
            
            const inputSetup = document.getElementById('projSetup').value;
            const setupTotal = inputSetup !== "" ? parseFloat(inputSetup) : (racks * 25000); 
            const movingTotal = parseFloat(document.getElementById('projMoving').value) || 0;
            const smartHandsMensal = parseFloat(document.getElementById('projSmartHands').value) || 0;

            const potenciaTotal = racks * kva;
            const mrrColocation = potenciaTotal * VALOR_KVA;
            const mrrTotal = mrrColocation + smartHandsMensal;
            const tcv = (mrrTotal * term) + setupTotal + movingTotal;

            let comissaoPerc = 0;
            if (term === 24) comissaoPerc = 0.05;
            if (term === 36) comissaoPerc = 0.07;
            if (term === 48) comissaoPerc = 0.085;
            if (term >= 60) comissaoPerc = 0.10;

            const comissaoValor = tcv * comissaoPerc;

            projetos.push({
                client: document.getElementById('projClient').value,
                term: term, racks: racks, kva: kva, totalKva: potenciaTotal,
                setup: setupTotal, moving: movingTotal, smartHands: smartHandsMensal,
                tcv: tcv, comPerc: comissaoPerc * 100, comValor: comissaoValor
            });
            
            document.getElementById('formProject').reset();
            document.getElementById('projTerm').value = "24"; // Reset para default
            document.getElementById('projRacks').value = "1";
            renderProject();
        });

        function renderProject() {
            const tbody = document.getElementById('tableProject');
            tbody.innerHTML = '';
            
            let sumTcv = 0; let sumCom = 0;
            const currencyPrefix = currentLang === 'en' ? '$' : (currentLang === 'es' ? 'MXN/CLP/ARS' : 'R$');

            projetos.forEach((item, index) => {
                sumTcv += item.tcv; sumCom += item.comValor;
                
                tbody.innerHTML += `<tr class="border-b hover:bg-white transition">
                    <td class="p-3 font-bold">${item.client}</td>
                    <td class="p-3 text-center"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-bold">${item.term}</span></td>
                    <td class="p-3 text-center text-xs text-slate-500">${item.racks} Racks <br> <span class="font-bold text-orange-600">${item.totalKva} kVA</span></td>
                    <td class="p-3 text-right text-xs text-slate-500">S: ${item.setup} <br> M: ${item.moving} <br> SH: ${item.smartHands}</td>
                    <td class="p-3 text-right font-black text-slate-800">${item.tcv.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                    <td class="p-3 text-right"><span class="block font-black text-green-600">${item.comValor.toLocaleString('en-US', {minimumFractionDigits: 2})}</span><span class="text-xs text-slate-400">(${item.comPerc}%)</span></td>
                    <td class="p-3 text-center"><button onclick="removeRow(${index})" class="text-red-400 hover:text-red-600"><i class="fas fa-trash"></i></button></td>
                </tr>`;
            });

            document.getElementById('totalTcvView').innerText = `${currencyPrefix} ${sumTcv.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('totalComView').innerText = `${currencyPrefix} ${sumCom.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
        }

        function removeRow(index) {
            projetos.splice(index, 1);
            renderProject();
        }

        // Exporta√ß√£o Din√¢mica (Respeitando o Idioma)
        function exportAllToCSV() {
            const dict = i18n[currentLang];
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Cabe√ßalho din√¢mico
            csvContent += `"${dict.thClient}","${dict.thContract}","${dict.racksLbl}","${dict.kvaLbl}","Setup","Moving","SmartHands","${dict.thTCV}","${dict.thCom}"\n`;
            
            projetos.forEach(p => { 
                csvContent += `"${p.client}",${p.term},${p.racks},${p.totalKva},${p.setup},${p.moving},${p.smartHands},${p.tcv},${p.comPerc}\n`; 
            });
            
            const partnerName = document.getElementById('partnerInput').value || 'Partner';
            const link = document.createElement("a");
            link.setAttribute("href", encodeURI(csvContent));
            link.setAttribute("download", `NextStream_QBR_${partnerName}_${currentLang.toUpperCase()}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
